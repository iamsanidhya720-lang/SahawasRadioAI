<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sahawas AI - Medical Report Analysis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: 
                linear-gradient(rgba(0, 20, 40, 0.85), rgba(0, 30, 60, 0.90)),
                url('https://i.ibb.co/hRSg34FD/background.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
            color: white;
            position: relative;
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(rgba(0, 20, 40, 0.95), rgba(0, 30, 60, 0.98)),
                url('https://i.ibb.co/wFRqwMd/medical-background.jpg');
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeOut 0.8s ease-out 4s forwards;
        }
        
        .loading-text {
            font-family: 'Times New Roman', serif;
            font-size: 1.5rem;
            font-weight: normal;
            color: #ffffff;
            margin-bottom: 30px;
            text-align: center;
            letter-spacing: 1px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.7);
            opacity: 0;
            transform: translateY(30px);
            animation: slideInFade 1.5s ease-out 0.5s forwards, textPulse 2s ease-in-out 2s infinite;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255,255,255,0.2);
            border-top: 3px solid #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite, spinScale 2s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.4);
        }
        
        @keyframes fadeOut {
            to { opacity: 0; pointer-events: none; }
        }
        
        @keyframes slideInFade {
            0% {
                opacity: 0;
                transform: translateY(30px) scale(0.9);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        @keyframes textPulse {
            0%, 100% { 
                opacity: 1; 
                text-shadow: 0 2px 10px rgba(0,0,0,0.7);
            }
            50% { 
                opacity: 0.8; 
                text-shadow: 0 2px 20px rgba(0,0,0,0.9), 0 0 30px rgba(255,255,255,0.2);
            }
        }
        
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        
        @keyframes spinScale {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* WhatsApp Button */
        .whatsapp-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: #25d366;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            box-shadow: 0 4px 20px rgba(37, 211, 102, 0.3);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .whatsapp-btn:hover {
            transform: scale(1.1);
        }

        .whatsapp-btn::before {
            content: "üìû";
            font-size: 24px;
        }

        /* Container and Layout */
        .container { 
            max-width: 500px; 
            margin: 0 auto; 
            padding: 30px 20px; 
            position: relative; 
        }
        
        /* Header */
        .header { 
            text-align: center; 
            margin-bottom: 60px; 
            padding-top: 40px;
        }
        
        .header h1 { 
            font-family: 'Poppins', sans-serif;
            font-size: 3.5rem; 
            font-weight: 600; 
            margin-bottom: 20px; 
            color: #ffffff;
            letter-spacing: -1px;
            text-shadow: 0 4px 20px rgba(0,0,0,0.6);
            background: linear-gradient(135deg, #ffffff 0%, #00d4ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p { 
            font-family: 'Source Sans Pro', sans-serif;
            font-size: 1.1rem; 
            opacity: 0.9; 
            line-height: 1.6; 
            font-weight: 300;
            max-width: 450px;
            margin: 0 auto;
            text-shadow: 0 2px 10px rgba(0,0,0,0.4);
        }

        /* Form Sections */
        .form-section { 
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(25px); 
            border-radius: 16px; 
            padding: 36px; 
            margin-bottom: 28px; 
            border: 1px solid rgba(255,255,255,0.25);
            box-shadow: 0 8px 32px rgba(0, 20, 40, 0.3);
        }
        
        .form-title { 
            font-family: 'Poppins', sans-serif;
            font-size: 1.3rem; 
            font-weight: 600;
            margin-bottom: 28px; 
            color: #ffffff;
            letter-spacing: 0.3px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.4);
        }
        
        /* Radio Group */
        .radio-group { 
            display: flex; 
            gap: 24px; 
            margin-bottom: 0; 
            flex-wrap: wrap;
        }
        
        .radio-item { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            cursor: pointer;
            font-weight: 400;
            font-size: 0.95rem;
            color: rgba(255,255,255,0.9);
        }
        
        .radio-item input[type="radio"] { 
            width: 18px; 
            height: 18px; 
            accent-color: #3b82f6;
        }

        /* Upload Area */
        .upload-area { 
            border: 2px dashed rgba(255,255,255,0.3); 
            border-radius: 8px; 
            padding: 48px 24px; 
            text-align: center; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            margin-bottom: 0; 
        }
        
        .upload-area:hover { 
            border-color: rgba(255,255,255,0.5); 
            background: rgba(255,255,255,0.05); 
        }
        
        .upload-area.dragover { 
            border-color: #3b82f6; 
            background: rgba(59, 130, 246, 0.1); 
        }
        
        .upload-area p {
            margin: 8px 0;
            font-size: 0.95rem;
            color: rgba(255,255,255,0.8);
        }
        
        .upload-area p:first-child {
            font-weight: 500;
            font-size: 1rem;
            color: #ffffff;
        }
        
        .upload-icon { 
            font-size: 2.5rem; 
            margin-bottom: 16px; 
            opacity: 0.6; 
        }
        
        .file-input { display: none; }
        
        .image-preview { 
            max-width: 100%; 
            max-height: 300px;
            border-radius: 8px; 
            margin: 20px 0; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        /* Analyze Button */
        .analyze-btn { 
            width: 100%; 
            padding: 18px; 
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            border: none; 
            border-radius: 12px; 
            color: white; 
            font-size: 1.1rem; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            margin-top: 28px; 
            font-family: 'Poppins', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.3);
        }
        
        .analyze-btn:hover { 
            background: linear-gradient(135deg, #0099cc 0%, #007399 100%);
            transform: translateY(-2px); 
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.4);
        }
        
        .analyze-btn:disabled { 
            opacity: 0.6; 
            cursor: not-allowed; 
            transform: none; 
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.2);
        }

        /* Loading and Results */
        .loading { 
            display: none; 
            text-align: center; 
            padding: 28px;
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(25px);
            border-radius: 16px;
            margin-top: 28px;
            border: 1px solid rgba(255,255,255,0.25);
            box-shadow: 0 8px 32px rgba(0, 20, 40, 0.3);
        }
        
        .loading p {
            font-family: 'Source Sans Pro', sans-serif;
            font-weight: 400;
            font-size: 1.05rem;
            color: rgba(255,255,255,0.9);
        }
        
        .spinner { 
            border: 3px solid rgba(255,255,255,0.3); 
            border-radius: 50%; 
            border-top: 3px solid #00d4ff; 
            width: 45px; 
            height: 45px; 
            animation: spin 1s linear infinite; 
            margin: 0 auto 20px; 
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }
        
        .result-section { 
            display: none; 
            background: rgba(255,255,255,0.98); 
            color: #1a202c; 
            border-radius: 16px; 
            padding: 36px; 
            margin-top: 28px; 
            box-shadow: 0 12px 40px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .result-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 28px; 
            flex-wrap: wrap; 
            gap: 20px; 
        }
        
        .result-header h2 { 
            font-family: 'Poppins', sans-serif;
            font-size: 1.6rem; 
            font-weight: 600;
            color: #1a202c; 
        }
        
        .export-btn { 
            padding: 12px 24px; 
            background: linear-gradient(135deg, #10b981, #059669);
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 600; 
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .export-btn:hover { 
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px); 
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        
        .disclaimer { 
            background: #fef3c7; 
            border: 1px solid #f59e0b; 
            color: #92400e; 
            padding: 16px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            font-size: 0.9rem; 
        }
        
        .analysis-content { 
            line-height: 1.8; 
            font-family: 'Times New Roman', serif;
            font-size: 1.05rem;
            color: #2d3748;
        }
        
        .analysis-content h3 { 
            color: #1a202c; 
            margin: 28px 0 16px 0; 
            font-size: 1.3rem;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            border-left: 4px solid #00d4ff;
            padding-left: 16px;
        }
        
        .analysis-content ul { margin-left: 20px; margin-bottom: 16px; }
        .analysis-content li { margin-bottom: 8px; }

        /* Footer */
        .footer { 
            text-align: center; 
            margin-top: 60px; 
            padding: 32px 20px; 
            background: rgba(255,255,255,0.1); 
            border-radius: 12px; 
        }
        
        .footer-links { 
            display: flex; 
            justify-content: center; 
            gap: 24px; 
            margin-bottom: 20px; 
        }
        
        .footer-links a { 
            font-size: 1.5rem;
            text-decoration: none;
            transition: transform 0.3s ease;
        }
        
        .footer-links a:hover {
            transform: scale(1.2);
        }

        .hospital-info h3 {
            font-size: 1.3rem;
            margin-bottom: 8px;
            color: #ffffff;
        }

        .hospital-info p {
            font-size: 1.1rem;
            color: rgba(255,255,255,0.9);
            margin-bottom: 16px;
        }

        .owner-info {
            font-size: 0.95rem;
            margin-bottom: 16px;
            color: rgba(255,255,255,0.8);
        }

        .disclaimer-footer {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.7);
            margin-bottom: 12px;
        }

        .creator-info {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.6);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .form-section {
                padding: 24px;
            }
            
            .radio-group {
                flex-direction: column;
                gap: 16px;
            }
            
            .result-header {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="loading-screen">
        <div class="loading-text">You Will Be Fine üòä</div>
        <div class="loading-spinner"></div>
    </div>

    <a href="https://wa.me/919260692607" target="_blank" class="whatsapp-btn" title="Call Now"></a>

    <div class="container">
        <div class="header">
            <h1>Sahawas AI</h1>
            <p>Your personal AI health assistant. Get simple, clear explanations of your medical reports.</p>
        </div>

        <div class="form-section">
            <div class="form-title">
                <span>1.</span>
                <span>Select Report Type</span>
            </div>
            <div class="radio-group">
                <label class="radio-item">
                    <input type="radio" name="reportType" value="radiology" checked>
                    <span>Radiology (MRI, CT Scan)</span>
                </label>
                <label class="radio-item">
                    <input type="radio" name="reportType" value="pathology">
                    <span>Pathology (Blood, CBC)</span>
                </label>
            </div>
        </div>

        <div class="form-section">
            <div class="form-title">
                <span>2.</span>
                <span>Upload Report</span>
            </div>
            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">üìÑ</div>
                <p><strong>Choose an Image</strong></p>
                <p>Drag & drop or click to select</p>
            </div>
            <input type="file" id="fileInput" class="file-input" accept="image/*">
            <img id="imagePreview" class="image-preview" style="display: none;">
        </div>

        <button class="analyze-btn" onclick="analyzeReport()">
            <span id="analyzeText">üî¨ Analyze Report</span>
        </button>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing your medical report with AI...</p>
        </div>

        <div class="result-section" id="resultSection">
            <div class="result-header">
                <h2>AI Analysis</h2>
                <button class="export-btn" onclick="exportToPDF()">üìÑ Export PDF</button>
            </div>
            <div class="disclaimer">
                <strong>Note:</strong> This is an AI-generated analysis for informational purposes only and should not be used for actual medical diagnosis. Always consult with a healthcare professional.
            </div>
            <div class="analysis-content" id="analysisContent"></div>
        </div>

        <div class="footer">
            <div class="footer-links">
                <a href="https://www.youtube.com" target="_blank" title="YouTube">üì∫</a>
                <a href="https://www.instagram.com" target="_blank" title="Instagram">üì∑</a>
            </div>
            <div class="hospital-info">
                <h3>Sahawas Hospital</h3>
                <p>9225109829</p>
            </div>
            <div class="owner-info">
                <strong>Owner:</strong> Dr. Sunil Sangle
            </div>
            <div class="disclaimer-footer">
                Disclaimer: This is an AI-generated analysis and not a substitute for professional medical advice.
            </div>
            <div class="creator-info">
                Created by Sanidhya S.
            </div>
        </div>
    </div>

    <script>
        let uploadedImageData = null;
        let analysisResult = '';
        let uploadedFile = null;

        // Google Gemini API Configuration - INTEGRATED
        const GEMINI_API_KEY = 'AIzaSyD7kG6vmfN6GQTShnt2_tdezfEJYHXC7CU';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro-vision:generateContent';

        // File upload handling
        const fileInput = document.getElementById('fileInput');
        const imagePreview = document.getElementById('imagePreview');
        const uploadArea = document.querySelector('.upload-area');

        fileInput.addEventListener('change', handleFileSelect);
        uploadArea.addEventListener('dragover', (e) => { 
            e.preventDefault(); 
            uploadArea.classList.add('dragover'); 
        });
        uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
        uploadArea.addEventListener('drop', handleFileDrop);

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) processFile(file);
        }

        function handleFileDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) processFile(file);
        }

        function processFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('Please upload an image file.');
                return;
            }

            uploadedFile = file;
            const reader = new FileReader();
            reader.onload = (e) => {
                uploadedImageData = e.target.result;
                imagePreview.src = uploadedImageData;
                imagePreview.style.display = 'block';
                uploadArea.querySelector('p').innerHTML = `<strong>${file.name}</strong><br>Ready to analyze`;
            };
            reader.readAsDataURL(file);
        }

        // Convert file to base64 for API
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = error => reject(error);
            });
        }

        async function analyzeReport() {
            if (!uploadedImageData || !uploadedFile) {
                alert('Please upload an image first.');
                return;
            }

            const reportType = document.querySelector('input[name="reportType"]:checked').value;
            const loading = document.getElementById('loading');
            const analyzeBtn = document.querySelector('.analyze-btn');
            const resultSection = document.getElementById('resultSection');

            loading.style.display = 'block';
            analyzeBtn.disabled = true;
            document.getElementById('analyzeText').textContent = 'Analyzing with AI...';
            resultSection.style.display = 'none';

            try {
                console.log('üöÄ Starting AI analysis with Gemini...');
                await performGeminiAnalysis(reportType);
                console.log('‚úÖ Analysis completed successfully!');
            } catch (error) {
                console.error('‚ùå Analysis failed:', error);
                
                let errorMessage = `**‚ö†Ô∏è ANALYSIS ERROR**\n\n${error.message}\n\n`;
                
                if (error.message.includes('CORS') || error.message.includes('Failed to fetch')) {
                    errorMessage += `**This is a browser CORS limitation.**\n\nThe Gemini API cannot be called directly from HTML files opened locally (file://) due to browser security.\n\n**Solutions:**\n1. Use a web server (Python: python -m http.server)\n2. Deploy to a hosting service\n3. Use the backend server approach I provided earlier\n\nWould you like to see a demo analysis instead?`;
                    
                    displayAnalysis(errorMessage);
                    setTimeout(() => {
                        const content = document.getElementById('analysisContent');
                        content.innerHTML += `<br><br><button onclick="showDemoAnalysis('${reportType}')" style="background: #10b981; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-family: Poppins;">üìã Show Demo Analysis</button>`;
                    }, 500);
                } else {
                    displayAnalysis(errorMessage);
                }
            } finally {
                loading.style.display = 'none';
                analyzeBtn.disabled = false;
                document.getElementById('analyzeText').innerHTML = 'üî¨ Analyze Report';
            }
        }

        async function performGeminiAnalysis(reportType) {
            try {
                console.log('üîÑ Converting image to base64...');
                const base64Image = await fileToBase64(uploadedFile);
                const mimeType = uploadedFile.type;
                
                const prompt = getAnalysisPrompt(reportType);
                
                const requestBody = {
                    contents: [{
                        parts: [
                            { text: prompt },
                            {
                                inline_data: {
                                    mime_type: mimeType,
                                    data: base64Image
                                }
                            }
                        ]
                    }],
                    generationConfig: {
                        temperature: 0.4,
                        topK: 32,
                        topP: 1,
                        maxOutputTokens: 4096,
                    },
                    safetySettings: [
                        { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                        { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                        { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                        { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
                    ]
                };

                console.log('üì° Calling Gemini API...');
                
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Error:', errorText);
                    throw new Error(`API Error: ${response.status} - ${errorText}`);
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    analysisResult = data.candidates[0].content.parts[0].text;
                    displayAnalysis(analysisResult);
                } else {
                    throw new Error('Invalid API response structure');
                }

            } catch (error) {
                if (error.message === 'Failed to fetch') {
                    throw new Error('CORS ERROR: Cannot fetch from Gemini API directly from file://');
                }
                throw error;
            }
        }

        function getAnalysisPrompt(reportType) {
            const basePrompt = `You are a professional medical AI assistant specializing in ${reportType} analysis. Analyze this medical image and provide a comprehensive, detailed report.

Please structure your response with these exact sections:

**IMAGING TECHNIQUE**
Describe the imaging modality, technique, and image quality assessment.

**ANATOMICAL STRUCTURES**
Detail all visible anatomical structures and their appearances.

**FINDINGS**
Provide detailed observations of any abnormalities, variations, or notable features. If normal, clearly state this.

**IMPRESSION**
Summarize the key findings and their clinical significance.

**RECOMMENDATIONS**
Suggest appropriate follow-up or additional studies if needed.

Requirements:
- Be thorough and professional in your analysis
- Use appropriate medical terminology
- Focus on what you can observe in the image
- Be specific about locations, sizes, and characteristics of findings
- If image quality limits assessment, mention this
- Always include appropriate medical disclaimers
- Provide actionable recommendations when appropriate`;

            if (reportType === 'radiology') {
                return basePrompt + `\n\nThis is a radiology image (X-ray, CT, MRI, ultrasound, etc.). Focus on imaging-specific findings, anatomical visualization, and any pathological changes visible.`;
            } else {
                return basePrompt + `\n\nThis is a pathology/laboratory report. Focus on test values, reference ranges, and clinical significance of any abnormal results.`;
            }
        }

        // Demo analysis for CORS issues
        window.showDemoAnalysis = function(reportType) {
            const timestamp = new Date().toLocaleString();
            const demoAnalysis = reportType === 'radiology' ? 
                `**DEMO AI ANALYSIS - RADIOLOGY REPORT**
*Generated: ${timestamp}*

**IMAGING TECHNIQUE**
Posteroanterior and lateral chest radiographs obtained using standard digital radiography technique. Image quality is adequate for diagnostic interpretation with appropriate exposure, positioning, and no significant motion artifact.

**ANATOMICAL STRUCTURES**
The cardiac silhouette appears normal in size and configuration with a cardiothoracic ratio within normal limits. Both hemidiaphragms are clearly visualized and appropriately positioned. The trachea is midline. Mediastinal contours are unremarkable. The visualized bony thorax shows no acute abnormality.

**FINDINGS**
The lungs are clear bilaterally with no evidence of focal consolidation, pleural effusion, or pneumothorax. The pulmonary vasculature appears normal in caliber and distribution. No masses, nodules, or infiltrates are identified. The costophrenic angles are sharp bilaterally. No pleural thickening or calcification is noted.

**IMPRESSION**
Normal chest radiograph. No acute cardiopulmonary findings. The heart size and pulmonary vasculature are within normal limits for age and body habitus.

**RECOMMENDATIONS**
- Clinical correlation with patient symptoms and physical examination findings
- No immediate follow-up imaging required unless clinically indicated
- Consider CT chest with contrast if there is high clinical suspicion despite normal radiograph
- Routine screening as per standard guidelines

**DISCLAIMER**
This is a demonstration analysis showing the AI interface functionality. For actual medical reports, please consult with a qualified radiologist or healthcare provider.` 
            : 
                `**DEMO AI ANALYSIS - LABORATORY REPORT**
*Generated: ${timestamp}*

**LABORATORY FINDINGS**
Complete Blood Count (CBC) and Basic Metabolic Panel analyzed from the uploaded laboratory report image.

**HEMATOLOGY PARAMETERS**
Based on visible values in the report:
- Hemoglobin levels appear within normal reference range
- White blood cell count within expected parameters
- Platelet count adequate for normal hemostasis
- Red blood cell indices suggest normal morphology

**BIOCHEMISTRY MARKERS**
- Glucose levels: Within fasting normal range
- Kidney function markers (Creatinine, BUN): Normal
- Liver function tests: Within acceptable limits
- Electrolytes (Na, K, Cl): Balanced and normal

**IMPRESSION**
Laboratory parameters appear grossly within normal reference ranges based on the visible data. No critical values or significant abnormalities identified in the current panel.

**RECOMMENDATIONS**
- Clinical correlation with patient symptoms essential
- Trending of values recommended if chronic condition monitoring
- Repeat testing as clinically indicated
- Consultation with ordering physician for comprehensive interpretation
- Consider additional specific tests if clinical presentation warrants

**QUALITY NOTE**
Analysis based on optical recognition of uploaded image. For precise values and comprehensive interpretation, please refer to the original laboratory report.

**DISCLAIMER**
This is a demonstration analysis. For actual medical decisions, always consult with qualified healthcare professionals and refer to official laboratory reports.`;
            
            displayAnalysis(demoAnalysis);
        }

        function displayAnalysis(analysis) {
            const content = document.getElementById('analysisContent');
            const formattedAnalysis = analysis
                .replace(/\*\*(.*?)\*\*/g, '<h3>$1</h3>')
                .replace(/\*(.*?)\*/g, '<strong>$1</strong>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n- /g, '<li>')
                .replace(/\n/g, '<br>');
            
            content.innerHTML = `<p>${formattedAnalysis}</p>`;
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        }

        function exportToPDF() {
            if (!analysisResult) {
                alert('Please analyze a report first before exporting.');
                return;
            }

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFont('times', 'normal');
                
                // Header
                doc.setFontSize(24);
                doc.setFont('times', 'bold');
                doc.setTextColor(30, 60, 114);
                doc.text('Sahawas AI', 105, 25, { align: 'center' });
                
                doc.setFontSize(16);
                doc.setFont('times', 'normal');
                doc.setTextColor(0, 0, 0);
                doc.text('Medical Report Analysis', 105, 35, { align: 'center' });
                
                const timestamp = new Date().toLocaleDateString();
                doc.setFontSize(10);
                doc.text(`Generated: ${timestamp}`, 105, 45, { align: 'center' });
                
                doc.setDrawColor(0, 188, 212);
                doc.setLineWidth(0.5);
                doc.line(20, 50, 190, 50);
                
                // Content
                doc.setFontSize(12);
                doc.setFont('times', 'normal');
                doc.setTextColor(51, 51, 51);
                
                let cleanContent = analysisResult
                    .replace(/\*\*(.*?)\*\*/g, '\n$1\n')
                    .replace(/\*(.*?)\*/g, '$1')
                    .replace(/\n\n+/g, '\n')
                    .trim();
                
                const lines = doc.splitTextToSize(cleanContent, 170);
                let yPosition = 60;
                const lineHeight = 6;
                const pageHeight = doc.internal.pageSize.height;
                const marginBottom = 50;
                
                for (let i = 0; i < lines.length; i++) {
                    if (yPosition + lineHeight > pageHeight - marginBottom) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    if (lines[i].match(/^[A-Z\s]+$/)) {
                        doc.setFont('times', 'bold');
                        doc.setFontSize(14);
                    } else {
                        doc.setFont('times', 'normal');
                        doc.setFontSize(12);
                    }
                    
                    doc.text(lines[i], 20, yPosition);
                    yPosition += lineHeight;
                }
                
                // Footer
                const currentPageHeight = doc.internal.pageSize.height;
                
                doc.setFillColor(240, 248, 255);
                doc.rect(0, currentPageHeight - 45, 210, 45, 'F');
                
                doc.setFontSize(11);
                doc.setFont('times', 'bold');
                doc.setTextColor(30, 60, 114);
                doc.text('For real-time consultation contact:', 20, currentPageHeight - 35);
                
                doc.setFont('times', 'normal');
                doc.setTextColor(0, 0, 0);
                doc.text('Dr. Sunil Sangle - Sahawas Hospital', 20, currentPageHeight - 28);
                doc.text('Phone: 9260692607', 20, currentPageHeight - 21);
                
                doc.setFontSize(9);
                doc.setTextColor(128, 128, 128);
                doc.setFont('times', 'italic');
                doc.text('Disclaimer: This is an AI-generated analysis and not a substitute for professional medical advice.', 105, currentPageHeight - 5, { align: 'center' });
                
                const fileTimestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
                doc.save(`Sahawas-AI-Analysis-${fileTimestamp}.pdf`);
                
                console.log('‚úÖ PDF exported successfully');
                
            } catch (error) {
                console.error('‚ùå PDF export error:', error);
                alert('Error exporting PDF. Please try again.');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Sahawas AI Medical Report Analysis loaded');
            console.log('üîë Gemini API Key integrated');
            console.log('‚úÖ Ready to analyze medical reports');
            console.log('‚ö†Ô∏è Note: Direct API calls may face CORS restrictions when opened as file://');
            console.log('üí° For production, serve via web server or use backend proxy');
        });
    </script>
</body>
</html>
